# めんどうくさいWebセキュリティ

## ch2: URLから始めよう
* 絶対URLの構造: `scheme://login:password@address:port/path/to/resource?query_string#fragment`
* URLにおける`オーソリティ`とは、以下の3つの情報を組み合わせたもの
  * リソースにアクセスするための資格情報 (`login.password@`)
  * データの提供元であるサーバー (`address`)
  * 接続先ポート番号 (`port`)
* ブラウザがURLをパースするアルゴリズムの例 (絶対URLの場合)
  * スキーム名を抽出: `:`より左にあるものが、scheme
  * 階層的URLを示すインジケータの処理: `//`があれば読み飛ばす
  * オーソリティの取り出し: `/`, `?`, `#` 以外の場合 (`\`, `;`を区切り文字と解釈するブラウザもあるので、これを含むこともある)
    * 認証情報の発見 (ある場合): `@`があれば対象。`:`があれば、loginとpasswordを分割
    * 宛先アドレスの取り出し: 残った部分が宛先アドレス。`:`があれば、addressとportを分離
  * パスの識別 (ある場合): オーソリティの直後に、`/`,(`\`,`:`)があり、その次に`?`,`#`,文字列の終端のいずれかを検索する
  * クエリ文字列の取り出し (ある場合): 直前に取り出した要素に続いて、`?`があれば、その次に`#`,文字列の終端のいずれかを検索する
  * フラグメント識別子の取り出し (ある場合): 直前に取り出した要素に続いて、`#`があれば、その次に文字列の終端までの全てがフラグメント識別子になる
* URL予約文字
  * `:`, `/`, `?`, `#`, `[`, `]`, `@`
  * 決まった用途はないものの、区切り文字として予約されているもの: `!`, `$`, `&`, `'`, `(`, `)`, `*`, `+`, `,`, `;`, `=`
* 上記のURL予約文字をURLに含める方法として、`パーセントエンコーディング(URLエンコーディング)`がある  
  * `%` + `ASCIIコード値を示した2桁の16進数値` で表現する
  
## ch6: ブラウザサイドスクリプト
* ブラウザに表示される全てのHTMLドキュメント(ウィンドウ・フレームに表示)には、独立したJS実行環境のインスタンスが与えられる
  * 実行環境には、読み込んだスクリプトで作成されるグローバル変数や関数が保存される、単一の名前空間が備わっている
* JSブロックは個別に実行される
* JSブロックは3段階の連続的なステップ(パース・関数の解決・コードの実行)によって処理される
* パース
  * スクリプトブロックの構文検証・中間的なバイナリ表現への変換
  * 構文エラーが発生した場合は、問題を起こしたブロック全体が捨てられ、パーサーはコード内で次に処理可能なチャンクへと処理を進める
* 関数の解決
  * パーサーが現在処理を行っているブロック内で発見した、名前を持つグローバル関数すべての登録を行う
  * これによって、次のステップであるコードの実行で、名前を持つグローバル関数関数が利用できるようになる
* コードの実行
  * 関数ブロックに含まれていない文を順次実行していく
  * 例外が発生すると処理が失敗する
    * ただし、解決済みの関数は他のJSブロック呼び出し可能
    * また、変数の状態も継続している
* JSの実行環境は、暗黙的なルートオブジェクトを中心として構造化されている
  * このルートオブジェクトは、デフォルトの名前空間として使用され、プログラムで作成する全てのグローバル変数・関数が所属する
  * ブラウザ環境の入出力機能を実装している関数階層も含む (`open()`, `setTimeout()`など)
  * 関連コンテキストに所属しているルートオブジェクトへのJS参照も提供する (`parent`, `frames[]`など)
* DOM (Document Object Model)
  * HTMLパーサーによって作成された、現在のドキュメントの回想定なインメモリ表現を提供するもの
  * JSのdocument階層を介してアクセスできる
  * ブラウザは、このインメモリ表現を使用して、現在表示されているドキュメントの描画と更新を行う (not HTMLソース)


